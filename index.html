<!doctype html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Assyrian III: Verb to Order Game</title>

  <!-- Noto Sans Syriac Eastern -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Syriac+Eastern:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#F7F9FC; --card:#FFFFFF; --ink:#0F172A; --muted:#475569;
      --accent:#2563EB; --success:#16A34A; --warn:#D97706; --danger:#DC2626; --line:#E5E7EB;
      --radius:16px; --active:#0ea5e9;
    }
    *{box-sizing:border-box}
    body{margin:0; background:var(--bg); color:var(--ink); font:16px/1.4 "Segoe UI", system-ui, Arial, sans-serif;}
    .wrap{max-width:1160px; margin:24px auto; padding:0 16px;}
    header{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px;}
    h1{font-size:22px; margin:0; font-weight:800;}
    .controls{display:flex; flex-wrap:wrap; align-items:center; gap:8px;}
    select, input[type="text"]{
      padding:8px 10px; border:1px solid var(--line); border-radius:10px; background:#fff; color:#0F172A;
    }
    .btn{appearance:none; border:0; padding:10px 14px; border-radius:10px; color:#fff; font-weight:700; cursor:pointer;}
    .btn.primary{background:var(--accent)}
    .btn.success{background:var(--success)}
    .btn.neutral{background:#334155}
    .btn.danger{background:var(--danger)}
    .btn.warn{background:var(--warn)}
    .btn:disabled{opacity:.6; cursor:not-allowed}
    .pill{display:inline-block; padding:2px 10px; border-radius:999px; background:#EEF2FF; color:#3730A3; font-weight:700; font-size:12px;}
    .timer{font-size:56px; font-weight:800; color:var(--accent); margin:4px 0 8px}
    .prompt{font-size:30px; font-weight:800; margin:8px 0 6px}
    .food{font-size:18px; font-style:italic; color:var(--warn); margin:0 0 6px}
    .answer{font-family:"Noto Sans Syriac Eastern","Segoe UI",system-ui,Arial,sans-serif; font-size:48px; color:var(--success); margin:12px 0 18px}
    .card{background:var(--card); border-radius:var(--radius); padding:16px; box-shadow:0 1px 0 rgba(0,0,0,.04); border:1px solid var(--line);}
    .row{display:flex; gap:16px; flex-wrap:wrap; align-items:center}
    .spacer{flex:1}
    .legend{color:var(--muted); font-size:12px}
    .scores .team{min-width:260px; border-radius:16px; padding:14px; border:2px solid var(--line); background:#fff; transition:background .2s,border-color .2s, box-shadow .2s}
    .scores .team.active{box-shadow:0 0 0 3px rgba(14,165,233,.25); border-color:var(--active)}
    .scores .team.answering{box-shadow:0 0 0 3px rgba(16,163,74,.4); border-color:var(--success)}
    .scores .team-title{font-size:18px; font-weight:800; margin-bottom:6px}
    .scores .score{font-size:26px; font-weight:800; margin:6px 0}
    .scores .grid{display:flex; gap:6px; flex-wrap:wrap}
    .point{padding:8px 10px; border-radius:10px; background:#E2E8F0; color:#0F172A; font-weight:800; border:1px solid #CBD5E1; cursor:pointer;}
    .point:hover{background:#CBD5E1}
    .team-bar{height:6px; border-radius:6px; background:#E5E7EB; overflow:hidden; margin-top:6px; position:relative}
    .team-bar .fill{height:100%; width:0%; transition:width .3s ease}
    .roundbar{height:8px; background:#E5E7EB; border-radius:8px; overflow:hidden}
    .roundbar .fill{height:100%; width:0%; background:var(--accent); transition:width .4s ease}
    .banner{margin:10px 0; padding:10px 14px; border-radius:10px; background:#ECFDF5; color:#065F46; border:1px solid #A7F3D0; font-weight:700}
    .hidden{display:none !important}
    .confetti{position:fixed; left:0; top:0; width:100%; height:100%; pointer-events:none; overflow:hidden}
    .piece{position:absolute; width:8px; height:12px; opacity:.9; transform:translate3d(0,0,0); animation:fall 1400ms linear forwards;}
    @keyframes fall{0%{transform:translate3d(var(--x),-10vh,0) rotate(0deg);}100%{transform:translate3d(calc(var(--x) + var(--dx)),110vh,0) rotate(360deg);opacity:.7;}}
    .games-card .big{font-size:18px; font-weight:800}
    .note{font-size:12px; color:var(--muted)}
    .modal-backdrop{position:fixed; inset:0; background:rgba(0,0,0,.4); display:flex; align-items:center; justify-content:center; z-index:50}
    .modal{background:#fff; border-radius:16px; padding:20px; max-width:640px; width:92%; border:1px solid var(--line); text-align:center}
    .modal h2{margin-top:0; font-size:24px}
    
    /* Multiple choice */
    .mc{display:flex; gap:10px; flex-wrap:wrap; margin-top:8px}
    .mc .opt{flex:1 1 48%; padding:12px; border:2px solid var(--line); border-radius:10px; background:#fff; cursor:pointer; font-weight:600; text-align:center; transition:all 0.2s;}
    .mc .opt:hover{background:#F8FAFC; border-color:#94A3B8;}
    .mc .opt.disabled{cursor:not-allowed; opacity:0.6;}
    .mc .opt.disabled:hover{background:#fff; border-color:var(--line);}
    .mc .opt.correct{border-color:#16A34A; background:#DCFCE7; color:#15803D;}
    .mc .opt.incorrect{border-color:#DC2626; background:#FEF2F2; color:#DC2626;}
    
    /* Team answer buttons */
    .team-answer-btn{
      padding:12px 18px; border-radius:12px; font-weight:700; cursor:pointer; 
      border:2px solid transparent; transition:all 0.2s; margin:4px 0;
      background:#F1F5F9; color:#334155;
    }
    .team-answer-btn:hover{background:#E2E8F0;}
    .team-answer-btn.active{border-color:var(--success); background:#ECFDF5; color:var(--success);}
    .team-answer-btn:disabled{opacity:0.5; cursor:not-allowed;}
    
    .lockpill{margin-left:8px}
    .answer-phase{background:#FEF3C7; border:1px solid #F59E0B; color:#92400E; padding:12px; border-radius:8px; margin:8px 0; text-align:center; font-weight:600;}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Assyrian III: Verb to Order Game</h1>
      <div class="controls">
        <button class="btn neutral" id="fullscreenBtn" title="Toggle fullscreen">Fullscreen</button>

        <label class="legend" for="timerSelect">Timer:</label>
        <select id="timerSelect" title="Seconds per round">
          <option>20</option><option selected>30</option><option>45</option><option>60</option>
        </select>

        <label class="legend" for="roundsSelect">Rounds:</label>
        <select id="roundsSelect" title="Number of rounds">
          <option>5</option><option selected>10</option><option>15</option><option>20</option>
        </select>

        <label class="legend"><input type="checkbox" id="noRepeat" checked> No-repeat</label>

        <label class="legend" for="dirSelect">Direction:</label>
        <select id="dirSelect" title="Question direction">
          <option value="EN2SY" selected>English → Assyrian</option>
          <option value="SY2EN">Assyrian → English</option>
          <option value="BOTH">Both</option>
        </select>

        <label class="legend" for="qtypeSelect">Question type:</label>
        <select id="qtypeSelect" title="Free Response or Multiple Choice or Mixed">
          <option value="FREE" selected>Free Response</option>
          <option value="MC">Multiple Choice</option>
          <option value="MIXED">Mixed</option>
        </select>

        <label class="legend" for="playersSelect">Players:</label>
        <select id="playersSelect" title="2 or 3 players">
          <option value="2" selected>2 Players</option>
          <option value="3">3 Players</option>
        </select>

        <button class="btn danger" id="resetScoresBtn" title="Reset all teams to 0">Reset Scores</button>
        <button class="btn warn" id="resetGameBtn" title="Reset game to round 1 with new question">Reset Game</button>
      </div>
    </header>

    <div class="card" style="margin-bottom:10px">
      <div class="row">
        <div><strong>Round:</strong> <span id="roundNow">1</span>/<span id="roundTotal">10</span></div>
        <div class="spacer"></div>
        <div style="min-width:280px">
          <div class="roundbar" title="Round progress"><div class="fill" id="roundFill"></div></div>
        </div>
      </div>
      <div id="endNote" class="note hidden" style="margin-top:8px;"></div>
    </div>

    <div class="timer" id="timerLabel">30 sec</div>

    <div class="prompt" id="promptLabel"></div>
    <div class="food" id="foodLabel"></div>

    <!-- Free-response answer (Syriac font) -->
    <div class="answer" id="answerLabel"></div>

    <!-- Multiple choice section -->
    <div id="mcSection" class="hidden">
      <!-- Team selection for MC -->
      <div id="teamAnswerPhase" class="answer-phase hidden">
        <div style="margin-bottom:8px;">Which team is answering this question?</div>
        <div id="teamAnswerBtns"></div>
      </div>
      
      <!-- Multiple choice answers -->
      <div id="mcWrap" class="mc"></div>
    </div>
    
    <span id="mcLock" class="pill lockpill hidden">Options unlock after 10 sec</span>

    <div class="row" style="margin-top:8px">
      <button class="btn success" id="showAnswerBtn" title="Reveal the answer and stop the timer" disabled>Show Answer</button>
      <button class="btn primary" id="nextBtn" title="Next random prompt (auto-starts timer)" disabled>Next Question</button>
      <span id="bonusPill" class="pill hidden">BONUS ROUND</span>
      <div class="spacer"></div>
      <div class="note">Shortcuts: Space=Start/Pause • Enter=Next • A=Show • 1/2/3=+1 • Shift+1/2/3=−1 • B/N/M=+2 bonus</div>
    </div>

    <div class="card scores" style="margin-top:14px">
      <div class="row">
        <!-- Team 1 -->
        <div class="team" id="t1Card">
          <div class="team-title" id="t1Title">Team 1</div>
          <div class="row">
            <input id="t1Name" type="text" value="Team 1" />
            <label class="legend">Color <input type="color" id="t1Color" value="#2563EB"></label>
          </div>
          <div class="score" id="t1Score">0</div>
          <div class="team-bar"><div class="fill" id="t1Bar" style="background:#2563EB"></div></div>
          <div class="legend" id="t1Streak">Streak: 0</div>
          <div class="grid" style="margin-top:6px">
            <button class="point" id="t1Plus">+1 (Correct)</button>
            <button class="point" id="t1Minus">-1 (Penalty)</button>
            <button class="point" id="t1Bonus" disabled>+2 BONUS</button>
          </div>
        </div>

        <!-- Team 2 -->
        <div class="team" id="t2Card">
          <div class="team-title" id="t2Title">Team 2</div>
          <div class="row">
            <input id="t2Name" type="text" value="Team 2" />
            <label class="legend">Color <input type="color" id="t2Color" value="#16A34A"></label>
          </div>
          <div class="score" id="t2Score">0</div>
          <div class="team-bar"><div class="fill" id="t2Bar" style="background:#16A34A"></div></div>
          <div class="legend" id="t2Streak">Streak: 0</div>
          <div class="grid" style="margin-top:6px">
            <button class="point" id="t2Plus">+1 (Correct)</button>
            <button class="point" id="t2Minus">-1 (Penalty)</button>
            <button class="point" id="t2Bonus" disabled>+2 BONUS</button>
          </div>
        </div>

        <!-- Team 3 (hidden unless selected) -->
        <div class="team hidden" id="t3Card">
          <div class="team-title" id="t3Title">Team 3</div>
          <div class="row">
            <input id="t3Name" type="text" value="Team 3" />
            <label class="legend">Color <input type="color" id="t3Color" value="#9333EA"></label>
          </div>
          <div class="score" id="t3Score">0</div>
          <div class="team-bar"><div class="fill" id="t3Bar" style="background:#9333EA"></div></div>
          <div class="legend" id="t3Streak">Streak: 0</div>
          <div class="grid" style="margin-top:6px">
            <button class="point" id="t3Plus">+1 (Correct)</button>
            <button class="point" id="t3Minus">-1 (Penalty)</button>
            <button class="point" id="t3Bonus" disabled>+2 BONUS</button>
          </div>
        </div>

        <div class="spacer"></div>
        <div class="games-card" style="min-width:280px">
          <div class="legend">Round & Game Results</div>
          <div id="banner" class="banner hidden">Round result will appear here.</div>
          <div class="card" style="padding:12px">
            <div class="big">Games Won</div>
            <div id="gamesTally" class="legend" style="margin-top:6px">—</div>
            <div id="gameLeader" class="legend" style="margin-top:6px">—</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Confetti layer -->
  <div class="confetti" id="confetti"></div>

  <!-- Modal (Congrats / New Game) -->
  <div id="modalWrap" class="modal-backdrop hidden">
    <div class="modal">
      <h2 id="modalTitle">Congratulations!</h2>
      <p id="modalBody">Game winner goes here.</p>
      <p class="note" style="margin-top:10px">Please call over Mr. Sargool and show your results before clicking Next Question.</p>
      <button class="btn primary" id="modalClose">Continue</button>
    </div>
  </div>

<script>
/* ---------------- DATA ---------------- */
const PHRASES = {
  "I order (masc.)": "ܛܵܠܒܹܢ",
  "I will order (masc.)": "ܛܵܠܒܹܢ ܒܸܕ",
  "I order (fem.)": "ܛܵܠܒܵܢ",
  "I will order (fem.)": "ܛܵܠܒܵܢ ܒܸܕ",
  "you order (masc.)": "ܛܵܠܒܹܬ",
  "you will order (masc.)": "ܛܵܠܒܹܬ ܒܸܕ",
  "you order (fem.)": "ܛܵܠܒܵܬܝ",
  "you will order (fem.)": "ܛܵܠܒܵܬܝ ܒܸܕ",
  "he orders": "ܛܵܠܹܒ",
  "he will order": "ܛܵܠܹܒ ܒܸܕ",
  "she orders": "ܛܵܠܒܵܐ",
  "she will order": "ܛܵܠܒܵܐ ܒܸܕ",
  "we order": "ܛܵܠܒܲܚ",
  "we will order": "ܛܵܠܒܲܚ ܒܸܕ",
  "they order": "ܛܵܠܒܝܼ",
  "they will order": "ܛܵܠܒܝܼ ܒܸܕ",
  "y'all order": "ܛܵܠܒܝܼܬܘܿܢ",
  "y'all will order": "ܛܵܠܒܝܼܬܘܿܢ ܒܸܕ",
};

const PRONOUNS = {
  i_masc: "ܐܵܢܵܐ", i_fem: "ܐܵܢܵܐ", you_masc:"ܐܲܢ݇ܬ", you_fem: "ܐܲܢ݇ܬܝ",
  he: "ܗ̇ܘ", she: "ܗ̇ܝ", we: "ܐܲܚܢܲܢ", yall: "ܐܲܚܬܘܿܢ", they: "ܐܵܢܝܼ",
};

const FOODS_EN = ["potatoes","rice","beans","stew","kabobs","chicken","steak","lamb","fish","fries","water","fizzy drinks","yogurt drink","lemonade","orange juice","dolma","red rice","okra stew","yogurt","Assyrian egg rolls","tea","coffee","hummus","baba ganosh","salad","pickles","meatballs"];
const FOODS_SY = ["ܟܸܪܬܘܿܦܹ̈ܐ","ܪܸܙܵܐ","ܚܲܒ̣ܨܹ̈ܐ","ܫܘܼܪܒ̣ܵܐ","ܟܵܒܵܒܹ̈ܐ","ܟܬܵܝܬܵܐ","ܒܸܣܪܵܐ","ܥܸܪܒܵܐ","ܢܘܼܢܵܐ","ܟܸܪܬܘܿܦܹ̈ܐ ܩܸܠܝܹ̈ܐ","ܡܝܼܵܐ","ܫܬܵܝܬܵܐ ܒܲܩܒܸܩܵܢܵܐ","ܕܲܘܹ̈ܐ","ܡܝܼܵܐ ܕܠܝܼܡܘܿܢܹ̈ܐ","ܡܝܼܵܐ ܕܦܘܼܪ̈ܬܩܵܠܹܐ","ܕܘܿܠܡܵܐ","ܪܸܙܵܐ ܣܡܘܿܩܵܐ","ܒܲܡܝܹ̈ܐ","ܡܲܣܬܵܐ","ܒܘܼܪܲܟ","ܟ̰ܵܐܝ","ܩܲܗܘܵܐ","ܚܲܪ̈ܛܡܵܢܹܐ ܓܪ̈ܝܼܣܹܐ","ܒܵܕܸܡܓ̰ܵܢܹ̈ܐ ܓܪ̈ܝܼܣܹܐ","ܣܲܠܵܛܵܐ","ܛܘܼܪ̈ܫܝܹܐ","ܟܸܦܬܹ̈ܐ"];

/* ---------------- DOM ELEMENTS ---------------- */
const timerLabel = document.getElementById('timerLabel');
const promptLabel = document.getElementById('promptLabel');
const foodLabel = document.getElementById('foodLabel');
const answerLabel = document.getElementById('answerLabel');
const mcSection = document.getElementById('mcSection');
const mcWrap = document.getElementById('mcWrap');
const mcLock = document.getElementById('mcLock');
const teamAnswerPhase = document.getElementById('teamAnswerPhase');
const teamAnswerBtns = document.getElementById('teamAnswerBtns');

const nextBtn = document.getElementById('nextBtn');
const showAnswerBtn = document.getElementById('showAnswerBtn');
const resetGameBtn = document.getElementById('resetGameBtn');

const timerSelect = document.getElementById('timerSelect');
const roundsSelect = document.getElementById('roundsSelect');
const dirSelect = document.getElementById('dirSelect');
const qtypeSelect = document.getElementById('qtypeSelect');
const playersSelect = document.getElementById('playersSelect');

const noRepeat = document.getElementById('noRepeat');
const fullscreenBtn = document.getElementById('fullscreenBtn');
const resetScoresBtn = document.getElementById('resetScoresBtn');
const bonusPill = document.getElementById('bonusPill');
const endNote = document.getElementById('endNote');

const scoreElements = [null, document.getElementById('t1Score'), document.getElementById('t2Score'), document.getElementById('t3Score')];
const cardElements = [null, document.getElementById('t1Card'), document.getElementById('t2Card'), document.getElementById('t3Card')];
const colorElements = [null, document.getElementById('t1Color'), document.getElementById('t2Color'), document.getElementById('t3Color')];
const barElements = [null, document.getElementById('t1Bar'), document.getElementById('t2Bar'), document.getElementById('t3Bar')];
const titleElements = [null, document.getElementById('t1Title'), document.getElementById('t2Title'), document.getElementById('t3Title')];
const nameElements = [null, document.getElementById('t1Name'), document.getElementById('t2Name'), document.getElementById('t3Name')];
const streakElements = [null, document.getElementById('t1Streak'), document.getElementById('t2Streak'), document.getElementById('t3Streak')];

// Button elements for manual scoring
const plusButtons = [null, document.getElementById('t1Plus'), document.getElementById('t2Plus'), document.getElementById('t3Plus')];
const minusButtons = [null, document.getElementById('t1Minus'), document.getElementById('t2Minus'), document.getElementById('t3Minus')];
const bonusButtons = [null, document.getElementById('t1Bonus'), document.getElementById('t2Bonus'), document.getElementById('t3Bonus')];

const roundNowEl = document.getElementById('roundNow');
const roundTotalEl = document.getElementById('roundTotal');
const roundFillEl = document.getElementById('roundFill');
const banner = document.getElementById('banner');
const gamesTally = document.getElementById('gamesTally');
const gameLeader = document.getElementById('gameLeader');

const modalWrap = document.getElementById('modalWrap');
const modalTitle = document.getElementById('modalTitle');
const modalBody = document.getElementById('modalBody');
const modalClose = document.getElementById('modalClose');
const confettiLayer = document.getElementById('confetti');

/* ---------------- GAME STATE ---------------- */
let timerSeconds = 30, currentTime = 30, timerId = null, timerRunning = false;
let currentPromptKey = '', isBonus = false, currentFoodIndex = null;
let directionMode = 'EN2SY', qtype = 'FREE', players = 2;
let score = [0, 0, 0, 0], streak = [0, 0, 0, 0], gamesWon = [0, 0, 0, 0];
let totalRounds = 10, currentRound = 1;
let promptsPool = Object.keys(PHRASES), unusedPrompts = [...promptsPool];
let roundStartScores = [0, 0, 0, 0];
let justFinishedGame = false;

// Multiple choice state
let mcEnabled = false, mcCorrectIndex = -1, mcOptions = [];
let answeringTeam = null; // Which team is currently answering
let lastRenderedDir = 'EN2SY', lastRenderedMode = 'FREE';
let canShowAnswer = false, answerUnlockTimeout = null;

/* ---------------- UTILITY FUNCTIONS ---------------- */
function hexToRgba(hex, alpha) {
  const m = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
  if (!m) return `rgba(0,0,0,${alpha})`;
  const r = parseInt(m[1], 16), g = parseInt(m[2], 16), b = parseInt(m[3], 16);
  return `rgba(${r},${g},${b},${alpha})`;
}

function teamName(i) {
  return nameElements[i]?.value.trim() || `Team ${i}`;
}

function teamColor(i) {
  return colorElements[i]?.value || '#2563EB';
}

function setTeamHighlights() {
  cardElements.forEach((card, idx) => {
    if (!card || idx === 0) return;
    card.classList.toggle('answering', idx === answeringTeam);
  });
}

/* ---------------- PROMPT LOGIC ---------------- */
function randomPromptFromPool() {
  if (noRepeat.checked) {
    if (unusedPrompts.length === 0) unusedPrompts = [...promptsPool];
    const i = Math.floor(Math.random() * unusedPrompts.length);
    return unusedPrompts.splice(i, 1)[0];
  }
  return promptsPool[Math.floor(Math.random() * promptsPool.length)];
}

function isFuture(key) {
  return key.toLowerCase().includes('will');
}

function detectPronounSyFromKey(key) {
  const p = key.toLowerCase();
  if (p.startsWith('i ')) return p.includes('(fem') ? PRONOUNS.i_fem : PRONOUNS.i_masc;
  if (p.startsWith('you ')) return p.includes('(fem') ? PRONOUNS.you_fem : PRONOUNS.you_masc;
  if (p.startsWith('he ')) return PRONOUNS.he;
  if (p.startsWith('she ')) return PRONOUNS.she;
  if (p.startsWith('we ')) return PRONOUNS.we;
  if (p.startsWith('they ')) return PRONOUNS.they;
  if (p.startsWith('y'all')) return PRONOUNS.yall;
  return '';
}

function buildSyAnswerFromKey(key, includeFood) {
  const base = PHRASES[key] || '';
  const fut = isFuture(key);
  const pron = detectPronounSyFromKey(key);
  const verb = base.replace(/\s*ܒܸܕ\s*$/, '').trim();
  let out = fut ? `${pron}  ܒܸܕ  ${verb}` : `${pron}  ${verb}`;
  if (includeFood && currentFoodIndex != null) out += `  ${FOODS_SY[currentFoodIndex]}`;
  return out;
}

function englishPronounFromKey(key) {
  if (key.toLowerCase().startsWith('y'all')) return "y'all";
  return key.split(' ')[0].replace('(masc.)', '').replace('(fem.)', '').trim();
}

function buildEnAnswerFromKey(key) {
  const fut = isFuture(key);
  let pron = englishPronounFromKey(key);
  let base = fut ? 'will order' : 'orders';
  const p = pron.toLowerCase();
  if (!fut && (p === 'i' || p === 'we' || p === 'they' || p === 'y'all')) base = '
