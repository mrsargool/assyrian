<!doctype html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Assyrian III: Verb To Order Game</title>

  <!-- Noto Sans Syriac Eastern for answers -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Syriac+Eastern:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#F7F9FC; --card:#FFFFFF; --ink:#0F172A; --muted:#475569;
      --accent:#2563EB; --success:#16A34A; --warn:#D97706; --danger:#DC2626; --line:#E5E7EB;
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{margin:0; background:var(--bg); color:var(--ink); font:16px/1.4 "Segoe UI", system-ui, Arial, sans-serif;}
    .wrap{max-width:1100px; margin:24px auto; padding:0 16px;}
    header{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px;}
    h1{font-size:22px; margin:0; font-weight:800;}
    .controls{display:flex; flex-wrap:wrap; align-items:center; gap:8px;}
    select, input[type="text"]{
      padding:8px 10px; border:1px solid var(--line); border-radius:10px; background:#fff; color:var(--ink);
    }
    .btn{appearance:none; border:0; padding:10px 14px; border-radius:10px; color:#fff; font-weight:700; cursor:pointer;}
    .btn.primary{background:var(--accent)}
    .btn.success{background:var(--success)}
    .btn.neutral{background:#334155}
    .btn.danger{background:var(--danger)}
    .btn.warn{background:var(--warn); color:#fff}
    .pill{display:inline-block; padding:2px 10px; border-radius:999px; background:#EEF2FF; color:#3730A3; font-weight:700; font-size:12px;}
    .timer{font-size:56px; font-weight:800; color:var(--accent); margin:4px 0 8px}
    .prompt{font-size:30px; font-weight:800; margin:8px 0 6px}
    .food{font-size:18px; font-style:italic; color:var(--warn); margin:0 0 6px}
    .answer{font-family:"Noto Sans Syriac Eastern","Segoe UI",system-ui,Arial,sans-serif; font-size:48px; color:var(--success); margin:12px 0 18px}
    .card{background:var(--card); border-radius:var(--radius); padding:16px; box-shadow:0 1px 0 rgba(0,0,0,.04); border:1px solid var(--line);}
    .row{display:flex; gap:16px; flex-wrap:wrap; align-items:center}
    .spacer{flex:1}
    .legend{color:var(--muted); font-size:12px}
    .scores .team{min-width:260px; border-radius:16px; padding:14px; border:1px solid var(--line); background:#fff;}
    .scores .team-title{font-size:18px; font-weight:800; margin-bottom:6px}
    .scores .score{font-size:26px; font-weight:800; margin:6px 0}
    .scores .grid{display:flex; gap:6px; flex-wrap:wrap}
    .point{padding:8px 10px; border-radius:10px; background:#E2E8F0; color:#0F172A; font-weight:800; border:1px solid #CBD5E1; cursor:pointer;}
    .point:hover{background:#CBD5E1}
    .team-bar{height:6px; border-radius:6px; background:#E5E7EB; overflow:hidden; margin-top:6px; position:relative}
    .team-bar .fill{height:100%; width:0%; transition:width .3s ease}
    .roundbar{height:8px; background:#E5E7EB; border-radius:8px; overflow:hidden}
    .roundbar .fill{height:100%; width:0%; background:var(--accent); transition:width .4s ease}
    .banner{margin:10px 0; padding:10px 14px; border-radius:10px; background:#ECFDF5; color:#065F46; border:1px solid #A7F3D0; font-weight:700}
    .hidden{display:none !important}
    .confetti{position:fixed; left:0; top:0; width:100%; height:100%; pointer-events:none; overflow:hidden}
    .piece{position:absolute; width:8px; height:12px; opacity:.9; transform:translate3d(0,0,0); animation:fall 1400ms linear forwards;}
    @keyframes fall{
      0%{ transform:translate3d(var(--x),-10vh,0) rotate(0deg); }
      100%{ transform:translate3d(calc(var(--x) + var(--dx)),110vh,0) rotate(360deg); opacity:.7; }
    }
    .games-card .big{font-size:18px; font-weight:800}
    .note{font-size:12px; color:var(--muted)}
    /* Modal overlay */
    .modal-backdrop{position:fixed; inset:0; background:rgba(0,0,0,.4); display:flex; align-items:center; justify-content:center; z-index:50}
    .modal{background:#fff; border-radius:16px; padding:20px; max-width:640px; width:92%; border:1px solid var(--line); text-align:center}
    .modal h2{margin-top:0; font-size:24px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Assyrian III: Verb To Order Game</h1>
      <div class="controls">
        <button class="btn neutral" id="fullscreenBtn" title="Toggle fullscreen">Fullscreen</button>
        <label class="legend" for="timerSelect">Timer:</label>
        <select id="timerSelect" title="Seconds per round">
          <option>20</option><option selected>30</option><option>45</option><option>60</option>
        </select>
        <label class="legend" for="roundsSelect">Total Rounds:</label>
        <select id="roundsSelect" title="Number of rounds">
          <option>5</option><option selected>10</option><option>15</option><option>20</option>
        </select>
        <label class="legend"><input type="checkbox" id="noRepeat" checked> No-repeat</label>
        <button class="btn danger" id="resetScoresBtn" title="Reset both teams to 0">Reset Scores</button>
      </div>
    </header>

    <div class="card" style="margin-bottom:10px">
      <div class="row">
        <div><strong>Round:</strong> <span id="roundNow">1</span>/<span id="roundTotal">10</span></div>
        <div class="spacer"></div>
        <div style="min-width:240px">
          <div class="roundbar" title="Round progress"><div class="fill" id="roundFill"></div></div>
        </div>
      </div>
      <div id="endNote" class="note hidden" style="margin-top:8px;"></div>
    </div>

    <div class="timer" id="timerLabel">30 sec</div>

    <div class="prompt" id="promptLabel"><!-- English prompt only --></div>
    <div class="food" id="foodLabel"><!-- Bonus: English food only --></div>
    <div class="answer" id="answerLabel"><!-- Syriac answer only --></div>

    <div class="row">
      <button class="btn success" id="showAnswerBtn" title="Reveal Syriac answer and stop the timer">Show Answer</button>
      <button class="btn primary" id="nextBtn" title="Next random prompt (auto-starts timer)">Next Question</button>
      <span id="bonusPill" class="pill hidden">BONUS ROUND (+2)</span>
      <div class="spacer"></div>
      <div class="note">Shortcuts: Space=Start/Pause • Enter=Next • A=Show • 1/2=+1 • Shift+1/2=−1 • B/N=+2 (bonus)</div>
    </div>

    <div class="card scores" style="margin-top:14px">
      <div class="row">
        <!-- Team 1 -->
        <div class="team" id="t1Card">
          <div class="team-title" id="t1Title">Team 1</div>
          <div class="row">
            <input id="t1Name" type="text" value="Team 1" />
            <label class="legend">Color <input type="color" id="t1Color" value="#2563EB"></label>
          </div>
          <div class="score" id="t1Score">0</div>
          <div class="team-bar"><div class="fill" id="t1Bar" style="background:#2563EB"></div></div>
          <div class="legend" id="t1Streak">Streak: 0</div>
          <div class="grid" style="margin-top:6px">
            <button class="point" id="t1Plus">+1 (Correct)</button>
            <button class="point" id="t1Minus">-1 (Penalty)</button>
            <button class="point" id="t1Bonus" disabled>+2 BONUS</button>
          </div>
        </div>

        <!-- Team 2 -->
        <div class="team" id="t2Card">
          <div class="team-title" id="t2Title">Team 2</div>
          <div class="row">
            <input id="t2Name" type="text" value="Team 2" />
            <label class="legend">Color <input type="color" id="t2Color" value="#16A34A"></label>
          </div>
          <div class="score" id="t2Score">0</div>
          <div class="team-bar"><div class="fill" id="t2Bar" style="background:#16A34A"></div></div>
          <div class="legend" id="t2Streak">Streak: 0</div>
          <div class="grid" style="margin-top:6px">
            <button class="point" id="t2Plus">+1 (Correct)</button>
            <button class="point" id="t2Minus">-1 (Penalty)</button>
            <button class="point" id="t2Bonus" disabled>+2 BONUS</button>
          </div>
        </div>

        <div class="spacer"></div>
        <div class="games-card" style="min-width:260px">
          <div class="legend">Round & Game Results</div>
          <div id="banner" class="banner hidden">Round result will appear here.</div>
          <div class="card" style="padding:12px">
            <div class="big">Games Won</div>
            <div id="gamesTally" class="legend" style="margin-top:6px">—</div>
            <div id="gameLeader" class="legend" style="margin-top:6px">—</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Confetti layer -->
  <div class="confetti" id="confetti"></div>

  <!-- Modal (Congrats / New Game) -->
  <div id="modalWrap" class="modal-backdrop hidden">
    <div class="modal">
      <h2 id="modalTitle">Congratulations!</h2>
      <p id="modalBody">Game winner goes here.</p>
      <p class="note" style="margin-top:10px">Please call over Mr. Sargool and show your results before clicking Next Question.</p>
      <button class="btn primary" id="modalClose">Continue</button>
    </div>
  </div>

<script>
/* ---------------- DATA ---------------- */
const PHRASES = {
  "I order (masc.)": "ܛܵܠܒܹܢ",
  "I will order (masc.)": "ܛܵܠܒܹܢ ܒܸܕ",
  "I order (fem.)": "ܛܵܠܒܵܢ",
  "I will order (fem.)": "ܛܵܠܒܵܢ ܒܸܕ",

  "you order (masc.)": "ܛܵܠܒܹܬ",
  "you will order (masc.)": "ܛܵܠܒܹܬ ܒܸܕ",
  "you order (fem.)": "ܛܵܠܒܵܬܝ",
  "you will order (fem.)": "ܛܵܠܒܵܬܝ ܒܸܕ",

  "he orders": "ܛܵܠܹܒ",
  "he will order": "ܛܵܠܹܒ ܒܸܕ",
  "she orders": "ܛܵܠܒܵܐ",
  "she will order": "ܛܵܠܒܵܐ ܒܸܕ",

  "we order": "ܛܵܠܒܲܚ",
  "we will order": "ܛܵܠܒܲܚ ܒܸܕ",

  "they order": "ܛܵܠܒܝܼ",
  "they will order": "ܛܵܠܒܝܼ ܒܸܕ",

  "y’all order": "ܛܵܠܒܝܼܬܘܿܢ",
  "y’all will order": "ܛܵܠܒܝܼܬܘܿܢ ܒܸܕ",
};

const PRONOUNS = {
  i_masc: "ܐܵܢܵܐ",
  i_fem:  "ܐܵܢܵܐ",
  you_masc:"ܐܲܢ݇ܬ",
  you_fem: "ܐܲܢ݇ܬܝ",
  he:      "ܗ̇ܘ",
  she:     "ܗ̇ܝ",
  we:      "ܐܲܚܢܲܢ",
  yall:    "ܐܲܚܬܘܿܢ",
  they:    "ܐܵܢܝܼ",
};

// English foods
const FOODS_EN = [
  "potatoes","rice","beans","stew","kabobs","chicken","steak","lamb",
  "fish","fries","water","fizzy drinks","yogurt drink","lemonade",
  "orange juice","dolma","red rice","okra stew","yogurt",
  "Assyrian egg rolls","tea","coffee","hummus","baba ganosh",
  "salad","pickles","meatballs"
];

// Syriac foods aligned to FOODS_EN
const FOODS_SY = [
  "ܟܸܪܬܘܿܦܹ̈ܐ","ܪܸܙܵܐ","ܚܲܒ̣ܨܹ̈ܐ","ܫܘܼܪܒ̣ܵܐ","ܟܵܒܵܒܹ̈ܐ","ܟܬܵܝܬܵܐ","ܒܸܣܪܵܐ","ܥܸܪܒܵܐ",
  "ܢܘܼܢܵܐ","ܟܸܪܬܘܿܦܹ̈ܐ ܩܸܠܝܹ̈ܐ","ܡܝܼܵܐ","ܫܬܵܝܬܵܐ ܒܲܩܒܸܩܵܢܵܐ","ܕܲܘܹ̈ܐ","ܡܝܼܵܐ ܕܠܝܼܡܘܿܢܹ̈ܐ",
  "ܡܝܼܵܐ ܕܦܘܼܪ̈ܬܩܵܠܹܐ","ܕܘܿܠܡܵܐ","ܪܸܙܵܐ ܣܡܘܿܩܵܐ","ܒܲܡܝܹ̈ܐ","ܡܲܣܬܵܐ",
  "ܒܘܼܪܲܟ","ܟ̰ܵܐܝ","ܩܲܗܘܵܐ","ܚܲܪ̈ܛܡܵܢܹܐ ܓܪ̈ܝܼܣܹܐ","ܒܵܕܸܡܓ̰ܵܢܹ̈ܐ ܓܪ̈ܝܼܣܹܐ",
  "ܣܲܠܵܛܵܐ","ܛܘܼܪ̈ܫܝܹܐ","ܟܸܦܬܹ̈ܐ"
];

/* ------------- DOM refs ------------- */
const timerLabel   = document.getElementById('timerLabel');
const promptLabel  = document.getElementById('promptLabel');
const foodLabel    = document.getElementById('foodLabel');
const answerLabel  = document.getElementById('answerLabel');
const nextBtn      = document.getElementById('nextBtn');
const showAnswerBtn= document.getElementById('showAnswerBtn');
const timerSelect  = document.getElementById('timerSelect');
const roundsSelect = document.getElementById('roundsSelect');
const noRepeat     = document.getElementById('noRepeat');
const fullscreenBtn= document.getElementById('fullscreenBtn');
const resetScoresBtn=document.getElementById('resetScoresBtn');
const bonusPill    = document.getElementById('bonusPill');
const endNote      = document.getElementById('endNote');

const t1ScoreEl = document.getElementById('t1Score');
const t2ScoreEl = document.getElementById('t2Score');
const t1Plus = document.getElementById('t1Plus');
const t1Minus= document.getElementById('t1Minus');
const t1Bonus= document.getElementById('t1Bonus');
const t2Plus = document.getElementById('t2Plus');
const t2Minus= document.getElementById('t2Minus');
const t2Bonus= document.getElementById('t2Bonus');
const t1Color= document.getElementById('t1Color');
const t2Color= document.getElementById('t2Color');
const t1Bar  = document.getElementById('t1Bar');
const t2Bar  = document.getElementById('t2Bar');
const t1Card = document.getElementById('t1Card');
const t2Card = document.getElementById('t2Card');
const t1Title= document.getElementById('t1Title');
const t2Title= document.getElementById('t2Title');
const t1Name = document.getElementById('t1Name');
const t2Name = document.getElementById('t2Name');
const t1StreakEl = document.getElementById('t1Streak');
const t2StreakEl = document.getElementById('t2Streak');

const roundNowEl = document.getElementById('roundNow');
const roundTotalEl = document.getElementById('roundTotal');
const roundFillEl = document.getElementById('roundFill');
const banner = document.getElementById('banner');
const gamesTally = document.getElementById('gamesTally');
const gameLeader = document.getElementById('gameLeader');

const modalWrap = document.getElementById('modalWrap');
const modalTitle = document.getElementById('modalTitle');
const modalBody = document.getElementById('modalBody');
const modalClose = document.getElementById('modalClose');

const confettiLayer = document.getElementById('confetti');

/* ------------- State ------------- */
let timerSeconds = 30;
let currentTime = timerSeconds;
let timerId = null;
let timerRunning = false;

let currentPrompt = '';
let isBonus = false;
let currentFoodIndex = null; // index into FOODS_EN/SY

let score1 = 0, score2 = 0;
let streak1 = 0, streak2 = 0;

let totalRounds = 10;
let currentRound = 1;
let promptsPool = Object.keys(PHRASES);
let unusedPrompts = [...promptsPool];
let roundStartScores = {t1:0, t2:0};

let gamesWon1 = 0, gamesWon2 = 0;
let justFinishedGame = false;

/* ------------- Utilities ------------- */
function hexToRgba(hex, alpha){
  const m = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
  if(!m) return `rgba(0,0,0,${alpha})`;
  const r = parseInt(m[1],16), g = parseInt(m[2],16), b = parseInt(m[3],16);
  return `rgba(${r}, ${g}, ${b}, ${alpha})`;
}

/* ------------- Helpers ------------- */
function randomPromptFromPool(){
  if(noRepeat.checked){
    if(unusedPrompts.length===0) unusedPrompts = [...promptsPool];
    const i = Math.floor(Math.random()*unusedPrompts.length);
    return unusedPrompts.splice(i,1)[0];
  }
  const keys = promptsPool;
  return keys[Math.floor(Math.random()*keys.length)];
}
function isFuture(prompt){ return prompt.toLowerCase().includes('will'); }
function stripBed(s){ return s.replace(/\s*ܒܸܕ\s*$/,'').trim(); }

function detectPronoun(prompt){
  const p = prompt.toLowerCase();
  if(p.startsWith('i '))       return p.includes('(fem') ? PRONOUNS.i_fem : PRONOUNS.i_masc;
  if(p.startsWith('you '))     return p.includes('(fem') ? PRONOUNS.you_fem : PRONOUNS.you_masc;
  if(p.startsWith('he '))      return PRONOUNS.he;
  if(p.startsWith('she '))     return PRONOUNS.she;
  if(p.startsWith('we '))      return PRONOUNS.we;
  if(p.startsWith('they '))    return PRONOUNS.they;
  if(p.startsWith('y’all'))    return PRONOUNS.yall;
  return '';
}

function updateTimerLabel(){
  timerLabel.textContent = isBonus ? '--' : `${currentTime} sec`;
}
function setBonusUI(on){
  isBonus = on;
  bonusPill.classList.toggle('hidden', !on);
  t1Bonus.disabled = !on;
  t2Bonus.disabled = !on;
  updateTimerLabel();
}

/* ------------- Timer ------------- */
function stopTimer(){
  if(timerId){ clearInterval(timerId); timerId = null; }
  timerRunning = false;
}
function startTimer(){
  if(isBonus) return;
  stopTimer();
  timerRunning = true;
  timerId = setInterval(()=>{
    if(currentTime>0){
      currentTime--;
      updateTimerLabel();
    } else {
      stopTimer();
    }
  },1000);
}

/* ------------- Confetti ------------- */
function confettiBurst(colorA, colorB){
  const COUNT = 80;
  for(let i=0;i<COUNT;i++){
    const d = document.createElement('div');
    d.className = 'piece';
    const x = Math.random()*100+'vw';
    const dx = (Math.random()*40 - 20)+'vw';
    d.style.setProperty('--x', x);
    d.style.setProperty('--dx', dx);
    d.style.left = Math.random()*100+'%';
    d.style.background = Math.random()<0.5 ? colorA : colorB;
    confettiLayer.appendChild(d);
    setTimeout(()=>d.remove(), 1600);
  }
}

/* ------------- Scores / Streaks ------------- */
function renderScores(){
  t1ScoreEl.textContent = String(score1);
  t2ScoreEl.textContent = String(score2);
  const total = Math.max(1, score1 + score2);
  t1Bar.style.width = (score1/total*100).toFixed(0) + '%';
  t2Bar.style.width = (score2/total*100).toFixed(0) + '%';
}
function updateStreak(team, deltaPositive){
  if(team===1){
    streak1 = deltaPositive ? streak1+1 : 0;
    t1StreakEl.textContent = `Streak: ${streak1}`;
    if(streak1>=3){ score1+=1; streak1=0; t1StreakEl.textContent=`Streak: ${streak1} (bonus applied)`; renderScores(); }
  } else {
    streak2 = deltaPositive ? streak2+1 : 0;
    t2StreakEl.textContent = `Streak: ${streak2}`;
    if(streak2>=3){ score2+=1; streak2=0; t2StreakEl.textContent=`Streak: ${streak2} (bonus applied)`; renderScores(); }
  }
}

/* ------------- Rounds / Games ------------- */
function setRounds(n){
  totalRounds = n;
  roundTotalEl.textContent = String(totalRounds);
  currentRound = 1;
  roundNowEl.textContent = String(currentRound);
  roundFillEl.style.width = (currentRound-1)/Math.max(1,totalRounds)*100 + '%';
  banner.classList.add('hidden');
  roundStartScores = {t1:score1, t2:score2};
  endNote.classList.add('hidden');
  nextBtn.textContent = 'Next Question';
  justFinishedGame = false;
}
function finishRoundAndAdvance(){
  // compute deltas for the round
  const d1 = score1 - roundStartScores.t1;
  const d2 = score2 - roundStartScores.t2;
  const name1 = t1Name.value.trim() || 'Team 1';
  const name2 = t2Name.value.trim() || 'Team 2';
  let text = '';
  if(d1> d2) text = `Round winner: ${name1}`;
  else if(d2> d1) text = `Round winner: ${name2}`;
  else text = 'Round tied';
  banner.textContent = text;
  banner.classList.remove('hidden');

  // if final round, decide game winner now
  if(currentRound >= totalRounds){
    const gameText = score1===score2 ? 'Game tied' : ((score1>score2) ? `Game winner: ${name1}` : `Game winner: ${name2}`);
    // Update games tally and modal only if not tie
    if(score1!==score2){
      if(score1>score2) gamesWon1++; else gamesWon2++;
      // Congrats modal
      modalTitle.textContent = 'Congratulations!';
      modalBody.textContent = `${gameText}`;
      modalWrap.classList.remove('hidden');
      // confetti with winning color
      const c = (score1>score2) ? t1Color.value : t2Color.value;
      confettiBurst(c, '#ffffff');
    } else {
      // Tie modal
      modalTitle.textContent = 'Game Tied';
      modalBody.textContent = 'No game winner this time.';
      modalWrap.classList.remove('hidden');
    }
    updateGamesPanel();
    // Prepare Next button note
    endNote.innerHTML = 'Please call over Mr. Sargool and show your results before clicking <strong>Next Question</strong>.<br>(Next game will begin and scores will be reset, but you can see the games counter below.)';
    endNote.classList.remove('hidden');
    nextBtn.textContent = 'Next Question (Next game will begin and scores will be reset …)';
    justFinishedGame = true;
  }

  // advance round counter (visual)
  if(currentRound < totalRounds){
    currentRound++;
    roundNowEl.textContent = String(currentRound);
    roundFillEl.style.width = ((currentRound-1)/Math.max(1,totalRounds))*100 + '%';
    roundStartScores = {t1:score1, t2:score2};
  }
}
function updateGamesPanel(){
  const name1 = t1Name.value.trim() || 'Team 1';
  const name2 = t2Name.value.trim() || 'Team 2';
  gamesTally.textContent = `${name1}: ${gamesWon1}  •  ${name2}: ${gamesWon2}`;
  if(gamesWon1===gamesWon2) gameLeader.textContent = 'Games leader: tied';
  else gameLeader.textContent = `Games leader: ${gamesWon1>gamesWon2 ? name1 : name2}`;
}
function startNewGame(){
  // reset scores and rounds, keep gamesWon counters
  score1=0; score2=0; streak1=0; streak2=0;
  renderScores();
  t1StreakEl.textContent='Streak: 0'; t2StreakEl.textContent='Streak: 0';
  setRounds(parseInt(roundsSelect.value,10));
}

/* ------------- Flow ------------- */
function nextQuestion(){
  // If we just finished a game and the modal is open, do nothing until closed
  if(!modalWrap.classList.contains('hidden')) return;

  // If last game just finished, clicking Next starts a fresh game
  if(justFinishedGame){
    startNewGame();
  }

  // close previous round and move to next (or end game)
  finishRoundAndAdvance();

  // reset timer to selected value
  currentTime = timerSeconds;
  updateTimerLabel();
  answerLabel.textContent = '';

  // pick prompt (English only)
  currentPrompt = randomPromptFromPool();
  promptLabel.textContent = currentPrompt;

  // maybe bonus (English food only in question)
  if(Math.random() < 0.20){
    currentFoodIndex = Math.floor(Math.random()*FOODS_EN.length);
    foodLabel.textContent = `Bonus Round: with ${FOODS_EN[currentFoodIndex]}`;
    setBonusUI(true);
    stopTimer(); // frozen during bonus
  }else{
    currentFoodIndex = null;
    foodLabel.textContent = '';
    setBonusUI(false);
    startTimer(); // auto-start timer
  }
}

function showAnswer(){
  // stop timer when showing answer
  stopTimer();

  // Syriac-only answer: pronoun + (ܒܸܕ if future) + verb (+ Syriac food)
  const base = PHRASES[currentPrompt] || '';
  const pron = detectPronoun(currentPrompt);
  const fut  = isFuture(currentPrompt);
  const verb = stripBed(base);
  let built  = fut ? `${pron}  ܒܸܕ  ${verb}` : `${pron}  ${verb}`;
  if(currentFoodIndex !== null){ built += `  ${FOODS_SY[currentFoodIndex]}`; }
  answerLabel.textContent = built;
}

/* ------------- Button handlers ------------- */
function addPoints(team, delta){
  if(team===1){
    score1 = Math.max(0, score1 + delta);
    renderScores();
    updateStreak(1, delta>0);
  } else {
    score2 = Math.max(0, score2 + delta);
    renderScores();
    updateStreak(2, delta>0);
  }
}
function addBonus(team){
  if(!isBonus) return;
  addPoints(team, 2);
  // celebration confetti per team color (visual only)
  const cA = team===1 ? t1Color.value : t2Color.value;
  confettiBurst(cA, '#ffffff');
}

t1Plus.onclick = ()=>addPoints(1,1);
t1Minus.onclick= ()=>addPoints(1,-1);
t1Bonus.onclick= ()=>addBonus(1);

t2Plus.onclick = ()=>addPoints(2,1);
t2Minus.onclick= ()=>addPoints(2,-1);
t2Bonus.onclick= ()=>addBonus(2);

resetScoresBtn.onclick = ()=>{ score1=0; score2=0; streak1=0; streak2=0; t1StreakEl.textContent='Streak: 0'; t2StreakEl.textContent='Streak: 0'; renderScores(); banner.classList.add('hidden'); roundStartScores={t1:0,t2:0}; };

showAnswerBtn.onclick = showAnswer;
nextBtn.onclick = nextQuestion;

timerSelect.onchange = (e)=>{ timerSeconds = parseInt(e.target.value,10); currentTime = timerSeconds; updateTimerLabel(); };
roundsSelect.onchange = (e)=>{ setRounds(parseInt(e.target.value,10)); };

/* Live-updating team names and colors */
function updateTeamTitle(which){
  const name = (which===1 ? t1Name.value.trim() : t2Name.value.trim()) || (which===1?'Team 1':'Team 2');
  (which===1? t1Title : t2Title).textContent = name;
  updateGamesPanel();
}
t1Name.addEventListener('input', ()=>updateTeamTitle(1));
t2Name.addEventListener('input', ()=>updateTeamTitle(2));

function applyTeamColor(which){
  const color = which===1 ? t1Color.value : t2Color.value;
  const card  = which===1 ? t1Card : t2Card;
  const bar   = which===1 ? t1Bar  : t2Bar;
  card.style.background = hexToRgba(color, 0.10);   // soft tint
  card.style.borderColor = hexToRgba(color, 0.6);
  bar.style.background = color;
}
t1Color.oninput = ()=>applyTeamColor(1);
t2Color.oninput = ()=>applyTeamColor(2);

/* Fullscreen */
fullscreenBtn.onclick = ()=>{
  const el = document.documentElement;
  if(!document.fullscreenElement){ el.requestFullscreen?.(); } else { document.exitFullscreen?.(); }
};

/* Modal */
modalClose.onclick = ()=>{
  modalWrap.classList.add('hidden');
  // After closing results, allow Next to start new game
  justFinishedGame = true;
};

/* ------------- Keyboard shortcuts ------------- */
document.addEventListener('keydown', (e)=>{
  if(e.target.tagName==='INPUT' || e.target.tagName==='SELECT' || e.target.isContentEditable) return;
  if(e.key===' '){ e.preventDefault(); if(isBonus){ return; } if(timerRunning){ stopTimer(); } else { startTimer(); } }
  if(e.key==='Enter'){ e.preventDefault(); nextQuestion(); }
  if(e.key.toLowerCase()==='a'){ e.preventDefault(); showAnswer(); }
  if(e.key==='1' && !e.shiftKey){ addPoints(1,1); }
  if(e.key==='2' && !e.shiftKey){ addPoints(2,1); }
  if(e.key==='1' && e.shiftKey){ addPoints(1,-1); }
  if(e.key==='2' && e.shiftKey){ addPoints(2,-1); }
  if(e.key.toLowerCase()==='b'){ addBonus(1); }
  if(e.key.toLowerCase()==='n'){ addBonus(2); }
});

/* ------------- Init ------------- */
(function init(){
  timerSeconds = parseInt(timerSelect.value,10);
  currentTime = timerSeconds;
  totalRounds = parseInt(roundsSelect.value,10);
  roundTotalEl.textContent = String(totalRounds);
  roundNowEl.textContent = String(currentRound);
  roundFillEl.style.width = '0%';
  renderScores();
  updateTimerLabel();
  roundStartScores = {t1:score1, t2:score2};
  applyTeamColor(1); applyTeamColor(2);
  updateTeamTitle(1); updateTeamTitle(2);
  updateGamesPanel();
  // First question
  currentPrompt = randomPromptFromPool();
  promptLabel.textContent = currentPrompt;
  // Not a bonus by default; start timer
  currentFoodIndex = null; foodLabel.textContent=''; setBonusUI(false); startTimer();
})();
</script>
</body>
</html>
